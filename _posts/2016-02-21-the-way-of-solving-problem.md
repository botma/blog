---
published: false
title: bug的解决方式
layout: post
author: Lin Jiang
category: 技术
tags: 
- tec
- 经验
- problem solving
---


前段时间在工作中遇到一个坑，我们读取了合作伙伴的数据库，里面有一个字段存放的一个对象的域名地址，但是也不知道什么原因，有一天这个地址的域名出了问题，合作伙伴只在应用的代码层将通过字符串替换成新的域名，而没有修改数据库中的值，这样，我们读取的就是错误的数据。

这只是一个小小的bug，但是我觉得有更好的解决方法，避免这个bug的出现。

借此谈谈解决问题的一个思路：

### 1. 搜集信息

搜集信息是解决问题的第一步，是非常重要的一步，但是发现问题的人和解决问题的人通常不是同一个人，有可能是开发队友发现的，测试发现的，运维发现的，用户发现的，事后核对发现的，基本上越往后越难于收集信息。关于用户反馈和事后核对，范围比较大，以后有机会在讲。

信息收集越完整，越有利后续解决问题的人，而且如果解决问题的人没有能力发现，完整的信息也有利于其去求助外界。

我们可以将问题分成两类：可复现的和偶现的。

可复现问题：里面比较常见的是对业务功能逻辑的理解有疏漏，忽略边界条件。一般来讲定位会比较简单，这时候只要能够把输入，异常输出记录下来基本就差不多了，后面只要一步一步跟踪代码即可找到问题的源发地。

偶现问题会比较麻烦，大多与运行时上下文有关，然而我们却很难从程序外部获取正确的上下文，特别是多线程环境。这里只能依赖代码开发过程写的log了，如果是event-driven的情况，那也比较好简单，记录事件的起止状态，外部依赖的状态（比如网络超时，数据库读写状态等），以及问题发生的时间，那么事后从日志中也能收集很多有用的信息。其他情况只能具体问题具体分析。

总的来讲，信息包含：who,when,what,how。

### 1. 问题在哪里

拿到了问题的反馈之后，有些人就会立即将有问题的输入弄到程序里面，开启debug模式，一步一步跟踪代码。这种方式也说不上好不好，但我一般会做这样做：

1. 先对问题简单的分类：
  - 是否可能是业务逻辑问题。
  - 是否可能是框架架构问题。
  - 是否跟外部依赖有关。

1. 预估最可能的问题发生点，

1. 思考那个地方的代码逻辑（自言自语，画流程草图等），

通常情况，经过上面这几步，找bug的过程就结束了。
但是若还是找不到问题所在呢？

1. 再理一下代码流程，
1. 放上几个break point，进入跟踪调试。


这样的找bug流程，看起来比较复杂，但有几个明显的好处：

1. 相当与又对代码进行了一次review，加深理解，发现潜在bug。
1. 理解一遍代码，对后续调试跟踪起到帮助
1. 锻炼自我的思维，总结提高
1. 很多情况，比直接单步调试更省时间。


但是有时候，经过了上诉步骤，依然没法找到问题的所在（比如无法单步，或者偶现问题），那么我们该怎么办？


### 1. 解决方案

通常情况下，经过上一步骤，我们知道了问题的根源，那么90%的情况，解决方案就会自动出现了。

根据，bug的严重性和紧急性，选择一个合适的方案

### 1. 后续优化

### 1. 知识储备




